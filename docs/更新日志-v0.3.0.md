# 项目更新日志

**版本**: v0.3.0  
**日期**: 2026-02-17  
**对比**: v0.2.0 → 当前版本

## 新增功能

### 1. 配置管理系统 (Configuration)
- ✅ 引入 `@nestjs/config` 模块
- ✅ 支持多环境配置 (`.env.development`, `.env.production`)
- ✅ 集成 `Joi` 进行配置项验证
- ✅ 类型安全的配置服务

**文件**:
- `src/config/config.schema.ts` - 验证 Schema
- `src/app.module.ts` - 全局配置注册
- `.env.development` / `.env.production` - 环境文件

### 2. 认证授权模块 (Auth Module)
- ✅ 基于 JWT (JSON Web Token) 的认证策略
- ✅ 登录接口 (`POST /auth/login`)
- ✅ 全局认证守卫 (`JwtAuthGuard`)
- ✅ 公开访问装饰器 (`@Public`)
- ✅ 密码安全校验与 Token 生成（有效期 1 年）

**文件**:
- `src/auth/auth.module.ts` - 认证模块
- `src/auth/auth.service.ts` - 认证业务逻辑
- `src/auth/auth.controller.ts` - 认证控制器
- `src/auth/jwt.strategy.ts` - JWT 策略
- `src/auth/jwt-auth.guard.ts` - 全局守卫
- `src/auth/decorators/public.decorator.ts` - 公开装饰器

### 3. SSE 实时推送 (Server-Sent Events)
- ✅ 实现基于 RxJS 的事件流推送
- ✅ 面试模块新增流式接口 (`GET /interview/stream`)
- ✅ 前端演示页面 (`public/sse.html`)
- ✅ 支持跨域访问 (CORS)

**文件**:
- `src/common/services/event.service.ts` - 事件服务
- `src/interview/interview.controller.ts` - SSE 端点
- `public/sse.html` - 演示页面
- `src/main.ts` - CORS 配置

### 4. 全局异常处理 (Exception Filters)
- ✅ 统一的异常处理链
- ✅ HTTP 异常过滤器
- ✅ MongoDB 异常过滤器
- ✅ 全局未捕获异常过滤器

**文件**:
- `src/common/filters/http-exception.filter.ts`
- `src/common/filters/mongo-exception.filter.ts`
- `src/common/filters/all-exceptions.filter.ts`
- `src/common/filters/global-exception.filter.ts`

### 5. 调试与工具
- ✅ 调试服务 (`DebugService`) 用于排查用户数据问题
- ✅ 增强的日志中间件和拦截器

## 优化与修复

### 1. 用户模块优化
- ✅ 开放注册接口 (`POST /users`) 允许未登录访问
- ✅ 增强 DTO 验证规则（密码复杂度、用户名称格式）
- ✅ 修复 `debug.service.ts` 导入路径错误

### 2. 系统配置优化
- ✅ `main.ts` 启用 `app.enableCors()` 支持跨域
- ✅ `package.json` 新增依赖：`@nestjs/config`, `@nestjs/jwt`, `@nestjs/passport`, `joi`, `rxjs` 等

## 文档系统

### 新增文档
- `docs/learning-notes-config-sse.md` - Config 与 SSE 学习笔记
- `docs/JWT_AUTH.md` - JWT 认证文档
- `docs/EXCEPTION_FILTERS.md` - 异常过滤器文档
- `docs/LOGIN_GUIDE.md` - 登录指南

## 代码统计

| 类型 | 新增数量 |
|------|----------|
| 模块 | Auth, Common |
| 控制器 | AuthController |
| 服务 | AuthService, EventService, DebugService |
| 守卫 | JwtAuthGuard |
| 策略 | JwtStrategy |
| 装饰器 | @Public, @CurrentUser |
| 过滤器 | 4 个异常过滤器 |
| 页面 | sse.html |

## API 端点更新

### 认证
- `POST /auth/login` - 用户登录

### 面试
- `GET /interview/stream` - SSE 实时消息流

### 用户
- `POST /users` - 注册用户（已移除认证限制）

---

**总结**: 本版本重点构建了系统的安全基石（JWT 认证）和实时通信能力（SSE），并引入了工程化配置管理（ConfigModule），使项目架构更加健壮和适用于生产环境。
